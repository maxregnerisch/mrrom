From 7a38e0538f973d691581c1c0c765566dc2d1d850 Mon Sep 17 00:00:00 2001
From: Ocin4ever <85343782+Ocin4ever@users.noreply.github.com>
Date: Fri, 18 Jul 2025 17:26:18 +0300
Subject: [PATCH] Add EAD APK Support

Signed-off-by: ExtremeXT <75576145+ExtremeXT@users.noreply.github.com>
---
 .../appops/AppOpsControllerImpl.smali         | 40 ++++++++++++++-----
 1 file changed, 31 insertions(+), 9 deletions(-)

diff --git a/smali/com/android/systemui/appops/AppOpsControllerImpl.smali b/smali/com/android/systemui/appops/AppOpsControllerImpl.smali
index 6f4557f6..21c2d143 100644
--- a/smali/com/android/systemui/appops/AppOpsControllerImpl.smali
+++ b/smali/com/android/systemui/appops/AppOpsControllerImpl.smali
@@ -751,7 +751,7 @@
 .method public final isUserVisible(Ljava/lang/String;Ljava/lang/String;)Z
     .locals 4
 
-    const-string v0, "com.samsung.sightcare"
+    const-string v0, "com.samsung.android.sead"
 
     invoke-virtual {v0, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
@@ -759,6 +759,8 @@
 
     const/4 v2, 0x0
 
+    const-string v3, "android"
+
     if-eqz v1, :cond_0
 
     iget-object v1, p0, Lcom/android/systemui/appops/AppOpsControllerImpl;->mContext:Landroid/content/Context;
@@ -767,24 +769,44 @@
 
     move-result-object v1
 
-    const-string v3, "android"
+    invoke-virtual {v1, v3, v0}, Landroid/content/pm/PackageManager;->checkSignatures(Ljava/lang/String;Ljava/lang/String;)I
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    :cond_0
+    const-string v0, "com.samsung.sightcare"
+
+    invoke-virtual {v0, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_2
+
+    iget-object v1, p0, Lcom/android/systemui/appops/AppOpsControllerImpl;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v1}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;
+
+    move-result-object v1
 
     invoke-virtual {v1, v3, v0}, Landroid/content/pm/PackageManager;->checkSignatures(Ljava/lang/String;Ljava/lang/String;)I
 
     move-result v0
 
-    if-nez v0, :cond_0
+    if-nez v0, :cond_2
 
+    :cond_1
     return v2
 
-    :cond_0
+    :cond_2
     iget-object p0, p0, Lcom/android/systemui/appops/AppOpsControllerImpl;->mContext:Landroid/content/Context;
 
     invoke-static {p0, p1}, Landroid/permission/PermissionManager;->shouldShowPackageForIndicatorCached(Landroid/content/Context;Ljava/lang/String;)Z
 
     move-result p0
 
-    if-nez p0, :cond_1
+    if-nez p0, :cond_3
 
     const-string p0, "SLocationService"
 
@@ -792,7 +814,7 @@
 
     move-result p0
 
-    if-nez p0, :cond_1
+    if-nez p0, :cond_3
 
     const-string p0, "Biometrics_FaceService"
 
@@ -800,12 +822,12 @@
 
     move-result p0
 
-    if-eqz p0, :cond_2
+    if-eqz p0, :cond_4
 
-    :cond_1
+    :cond_3
     const/4 v2, 0x1
 
-    :cond_2
+    :cond_4
     return v2
 .end method
 
-- 
2.45.2

